<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/main}">
<head>
<title>Room Detail</title>
</head>
<body>
	<section layout:fragment="content">
		<div class="row">
			<div class="col-md-5">
				<div class="card card-primary shadow">
					<div class="card-header">
						<h3 class="card-title">
							<span th:replace="~{components/icons :: roomIcon}"></span> Thông
							tin Phòng
						</h3>
					</div>
					<div class="card-body">
						<dl class="row">
							<dt class="col-sm-4">
								<span th:replace="~{components/icons :: idIcon}"></span> ID
							</dt>
							<dd class="col-sm-8 font-weight-bold"
								th:text="${roomDetailViewData.room.id}">ID</dd>

							<dt class="col-sm-4">
								<span th:replace="~{components/icons :: roomIcon}"></span> Tên
								phòng
							</dt>
							<dd class="col-sm-8" th:text="${roomDetailViewData.room.name}">Tên
								phòng</dd>

							<dt class="col-sm-4">
								<span th:replace="~{components/icons :: locationIcon}"></span>
								Vị trí
							</dt>
							<dd class="col-sm-8"
								th:text="${roomDetailViewData.room.location}">Vị trí</dd>

							<dt class="col-sm-4">
								<span th:replace="~{components/icons :: infoIcon}"></span> Mô tả
							</dt>
							<dd class="col-sm-8"
								th:text="${roomDetailViewData.room.description}">Mô tả</dd>
						</dl>
					</div>
				</div>

				<div class="card card-info shadow">
					<div class="card-header">
						<h3 class="card-title">
							<i class="fas fa-chart-bar"></i> Thống kê
						</h3>
					</div>
					<div class="card-body">
						<ul class="list-group list-group-flush">
							<li
								class="list-group-item d-flex justify-content-between align-items-center">
								<span th:replace="~{components/icons :: hubIcon}"></span> Tổng
								số Hub <span class="badge badge-success badge-pill"
								th:text="${roomDetailViewData.totalHub}">0</span>
							</li>
							<li
								class="list-group-item d-flex justify-content-between align-items-center">
								<span th:replace="~{components/icons :: deviceIcon}"></span>
								Tổng số Thiết bị <span class="badge badge-warning badge-pill"
								th:text="${roomDetailViewData.totalDevice}">0</span>
							</li>
							<li
								class="list-group-item d-flex justify-content-between align-items-center">
								<span th:replace="~{components/icons :: sensorIcon}"></span>
								Tổng số Cảm biến <span class="badge badge-danger badge-pill"
								th:text="${roomDetailViewData.totalSensor}">0</span>
							</li>
						</ul>

						<hr class="my-3" />

						<canvas id="roomDetailChart"
							style="min-height: 200px; height: 200px; max-height: 200px; max-width: 100%"></canvas>
					</div>
				</div>
			</div>

			<div class="col-md-7">
				<div
					th:replace="~{components/datatable :: card(
            cardTitle='Danh sách Hub trong phòng',
            pageData=${roomDetailViewData.hubs},
            pageUrl=@{/administration/components/rooms/{id}(id=${roomDetailViewData.room.id})},
            paramPrefix='',
            tableContent=~{::hubTable},
			filterContent=~{}
        )}">
					<div th:fragment="hubTable">
						<table class="table table-bordered table-hover table-striped">
							<thead class="thead-dark">
								<tr>
									<th><span th:replace="~{components/icons :: idIcon}"></span>
										ID</th>
									<th><span th:replace="~{components/icons :: hubIcon}"></span>
										Tên Hub</th>
									<th><span th:replace="~{components/icons :: locationIcon}"></span>
										Vị trí</th>
									<th><span th:replace="~{components/icons :: statusIcon}"></span>
										Trạng thái</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="hub : ${roomDetailViewData.hubs.content}">
									<td th:text="${hub.id}">ID</td>
									<td th:text="${hub.name}">Tên Hub</td>
									<td th:text="${hub.location}">Vị trí</td>
									<td><span th:text="${hub.status}"
										th:classappend="${hub.status == 'ACTIVE'} ? 'badge badge-success' : 'badge badge-secondary'">
											Trạng thái </span></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</section>
	<th:block layout:fragment="scripts">
		<script th:inline="javascript">
				/*<![CDATA[*/
				$(function () {
					const hubCount = /*[[${roomDetailViewData.totalHub}]]*/ 0;
					const deviceCount = /*[[${roomDetailViewData.totalDevice}]]*/ 0;
					const sensorCount = /*[[${roomDetailViewData.totalSensor}]]*/ 0;

					const chartData = {
						labels: ['Hub', 'Thiết bị', 'Cảm biến'],
						datasets: [
							{
								label: 'Số lượng',
								backgroundColor: [
									'rgba(40, 167, 69, 0.9)', // Hub
									'rgba(255, 193, 7, 0.9)', // Device
									'rgba(220, 53, 69, 0.9)', // Sensor
								],
								borderColor: ['rgba(40, 167, 69, 1)', 'rgba(255, 193, 7, 1)', 'rgba(220, 53, 69, 1)'],
								borderWidth: 1,
								data: [hubCount, deviceCount, sensorCount],
							},
						],
					};

					const chartOptions = {
						responsive: true,
						maintainAspectRatio: false,
						scales: {
							y: {
								ticks: {
									beginAtZero: true,
									callback: function (value) {
										if (Number.isInteger(value)) {
											return value;
										}
									},
								},
							},
							x: {
								grid: {
									display: false,
								},
							},
						},
						plugins: {
							legend: { display: false },
							tooltip: {
								callbacks: {
									label: function (context) {
										let label = context.dataset.label || '';
										if (label) label += ': ';
										label += context.parsed.y;
										return ' ' + label;
									},
								},
							},
						},
					};

					const chartCanvas = $('#roomDetailChart').get(0).getContext('2d');
					new Chart(chartCanvas, {
						type: 'bar',
						data: chartData,
						options: chartOptions,
					});
				});
				/*]]>*/
			</script>
	</th:block>
</body>
</html>
